"use strict";function Section(t,e){this._parent=t,this._heading=e,this._items=[]}var sprintf=require("sprintf-js").sprintf,c=require("../const"),$$=require("../utils");Section.prototype.addItem=function(t){this._items.push(t)},Section.prototype.formatHelp=function(t){var e,r;if(this._parent&&t._indent(),e=this._items.map(function(e){var r,n,i;return r=t,n=e[0],i=e[1],n.apply(r,i)}),e=t._joinParts(e),this._parent&&t._dedent(),!e)return"";if(r="",this._heading&&this._heading!==c.SUPPRESS){var n=t.currentIndent;r=$$.repeat(" ",n)+this._heading+":"+c.EOL}return t._joinParts([c.EOL,r,e,c.EOL])};var HelpFormatter=module.exports=function(t){t=t||{},this._prog=t.prog,this._maxHelpPosition=t.maxHelpPosition||24,this._width=t.width||(process.env.COLUMNS||80)-2,this._currentIndent=0,this._indentIncriment=t.indentIncriment||2,this._level=0,this._actionMaxLength=0,this._rootSection=new Section(null),this._currentSection=this._rootSection,this._whitespaceMatcher=new RegExp("\\s+","g"),this._longBreakMatcher=new RegExp(c.EOL+c.EOL+c.EOL+"+","g")};HelpFormatter.prototype._indent=function(){this._currentIndent+=this._indentIncriment,this._level+=1},HelpFormatter.prototype._dedent=function(){if(this._currentIndent-=this._indentIncriment,this._level-=1,this._currentIndent<0)throw new Error("Indent decreased below 0.")},HelpFormatter.prototype._addItem=function(t,e){this._currentSection.addItem([t,e])},HelpFormatter.prototype.startSection=function(t){this._indent();var e=new Section(this._currentSection,t),r=e.formatHelp.bind(e);this._addItem(r,[this]),this._currentSection=e},HelpFormatter.prototype.endSection=function(){this._currentSection=this._currentSection._parent,this._dedent()},HelpFormatter.prototype.addText=function(t){t&&t!==c.SUPPRESS&&this._addItem(this._formatText,[t])},HelpFormatter.prototype.addUsage=function(t,e,r,n){t!==c.SUPPRESS&&this._addItem(this._formatUsage,[t,e,r,n])},HelpFormatter.prototype.addArgument=function(t){if(t.help!==c.SUPPRESS){var e,r=this,n=[this._formatActionInvocation(t)],i=n[0].length;t._getSubactions&&(this._indent(),t._getSubactions().forEach(function(t){var e=r._formatActionInvocation(t);n.push(e),i=Math.max(i,e.length)}),this._dedent()),e=i+this._currentIndent,this._actionMaxLength=Math.max(this._actionMaxLength,e),this._addItem(this._formatAction,[t])}},HelpFormatter.prototype.addArguments=function(t){var e=this;t.forEach(function(t){e.addArgument(t)})},HelpFormatter.prototype.formatHelp=function(){var t=this._rootSection.formatHelp(this);return t&&(t=t.replace(this._longBreakMatcher,c.EOL+c.EOL),t=$$.trimChars(t,c.EOL)+c.EOL),t},HelpFormatter.prototype._joinParts=function(t){return t.filter(function(t){return t&&t!==c.SUPPRESS}).join("")},HelpFormatter.prototype._formatUsage=function(t,e,r,n){if(n||"string"==typeof n||(n="usage: "),e=e||[],r=r||[],t)t=sprintf(t,{prog:this._prog});else if(t||0!==e.length){if(!t){var i,o,a=this._prog,s=[],h=[];if(e.forEach(function(t){t.isOptional()?s.push(t):h.push(t)}),i=this._formatActionsUsage([].concat(s,h),r),t=[a,i].join(" "),o=this._width-this._currentIndent,n.length+t.length>o){var p=new RegExp("\\(.*?\\)+|\\[.*?\\]+|\\S+","g"),u=this._formatActionsUsage(s,r),l=this._formatActionsUsage(h,r),_=u.match(p),f=l.match(p)||[];if(_.join(" ")!==u)throw new Error("assert \"optionalParts.join(' ') === optionalUsage\"");if(f.join(" ")!==l)throw new Error("assert \"positionalParts.join(' ') === positionalUsage\"");var g,d,m,E=function(t,e,r){var n=[],i=[],a=r?r.length-1:e.length-1;return t.forEach(function(t){a+1+t.length>o&&(n.push(e+i.join(" ")),i=[],a=e.length-1),i.push(t),a+=t.length+1}),i&&n.push(e+i.join(" ")),r&&(n[0]=n[0].substr(e.length)),n};n.length+a.length<=.75*o?(d=$$.repeat(" ",n.length+a.length+1),g=_?[].concat(E([a].concat(_),d,n),E(f,d)):f?E([a].concat(f),d,n):[a]):(d=$$.repeat(" ",n.length),m=_.concat(f),g=E(m,d),g.length>1&&(g=[].concat(E(_,d),E(f,d))),g=[a].concat(g)),t=g.join(c.EOL)}}}else t=this._prog;return n+t+c.EOL+c.EOL},HelpFormatter.prototype._formatActionsUsage=function(t,e){var r=[],n=[],i=this;e.forEach(function(e){var i,o,a=t.indexOf(e._groupActions[0]);if(a>=0&&(i=a+e._groupActions.length,$$.arrayEqual(t.slice(a,i),e._groupActions)))for(e._groupActions.forEach(function(t){r.push(t)}),e.required?(n[a]?n[a]+=" (":n[a]="(",n[i]=")"):(n[a]?n[a]+=" [":n[a]="[",n[i]="]"),o=a+1;o<i;o+=1)n[o]="|"});var o=[];t.forEach(function(t,e){var a,s,h,p;t.help===c.SUPPRESS?(o.push(null),"|"===n[e]?n.splice(e,e):"|"===n[e+1]&&n.splice(e+1,e+1)):t.isOptional()?(s=t.optionStrings[0],0===t.nargs?a=""+s:(h=t.dest.toUpperCase(),p=i._formatArgs(t,h),a=s+" "+p),!t.required&&r.indexOf(t)<0&&(a="["+a+"]"),o.push(a)):(a=i._formatArgs(t,t.dest),r.indexOf(t)>=0&&"["===a[0]&&"]"===a[a.length-1]&&(a=a.slice(1,-1)),o.push(a))});for(var a=n.length-1;a>=0;--a)null!==n[a]&&o.splice(a,0,n[a]);var s=o.filter(function(t){return!!t}).join(" ");return s=s.replace(/([\[(]) /g,"$1"),s=s.replace(/ ([\])])/g,"$1"),s=s.replace(/\[ *\]/g,""),s=s.replace(/\( *\)/g,""),s=s.replace(/\(([^|]*)\)/g,"$1"),s=s.trim()},HelpFormatter.prototype._formatText=function(t){t=sprintf(t,{prog:this._prog});var e=this._width-this._currentIndent,r=$$.repeat(" ",this._currentIndent);return this._fillText(t,e,r)+c.EOL+c.EOL},HelpFormatter.prototype._formatAction=function(t){var e,r,n,i,o=this,a=Math.min(this._actionMaxLength+2,this._maxHelpPosition),s=this._width-a,h=a-this._currentIndent-2,p=this._formatActionInvocation(t);return t.help?p.length<=h?(p=$$.repeat(" ",this._currentIndent)+p+"  "+$$.repeat(" ",h-p.length),i=0):(p=$$.repeat(" ",this._currentIndent)+p+c.EOL,i=a):p=$$.repeat(" ",this._currentIndent)+p+c.EOL,n=[p],t.help?(e=this._expandHelp(t),r=this._splitLines(e,s),n.push($$.repeat(" ",i)+r[0]+c.EOL),r.slice(1).forEach(function(t){n.push($$.repeat(" ",a)+t+c.EOL)})):p.charAt(p.length-1)!==c.EOL&&n.push(c.EOL),t._getSubactions&&(this._indent(),t._getSubactions().forEach(function(t){n.push(o._formatAction(t))}),this._dedent()),this._joinParts(n)},HelpFormatter.prototype._formatActionInvocation=function(t){if(!t.isOptional()){return this._metavarFormatter(t,t.dest)(1)[0]}var e,r,n=[];return 0===t.nargs?n=n.concat(t.optionStrings):(e=t.dest.toUpperCase(),r=this._formatArgs(t,e),t.optionStrings.forEach(function(t){n.push(t+" "+r)})),n.join(", ")},HelpFormatter.prototype._metavarFormatter=function(t,e){var r;if(t.metavar||""===t.metavar)r=t.metavar;else if(t.choices){var n=t.choices;n="string"==typeof n?n.split("").join(", "):Array.isArray(n)?n.join(","):Object.keys(n).join(","),r="{"+n+"}"}else r=e;return function(t){if(Array.isArray(r))return r;for(var e=[],n=0;n<t;n+=1)e.push(r);return e}},HelpFormatter.prototype._formatArgs=function(t,e){var r,n,i=this._metavarFormatter(t,e);switch(t.nargs){case undefined:case null:n=i(1),r=""+n[0];break;case c.OPTIONAL:n=i(1),r="["+n[0]+"]";break;case c.ZERO_OR_MORE:n=i(2),r="["+n[0]+" ["+n[1]+" ...]]";break;case c.ONE_OR_MORE:n=i(2),r=n[0]+" ["+n[1]+" ...]";break;case c.REMAINDER:r="...";break;case c.PARSER:n=i(1),r=n[0]+" ...";break;default:n=i(t.nargs),r=n.join(" ")}return r},HelpFormatter.prototype._expandHelp=function(t){var e={prog:this._prog};return Object.keys(t).forEach(function(r){var n=t[r];n!==c.SUPPRESS&&(e[r]=n)}),e.choices&&("string"==typeof e.choices?e.choices=e.choices.split("").join(", "):Array.isArray(e.choices)?e.choices=e.choices.join(", "):e.choices=Object.keys(e.choices).join(", ")),sprintf(this._getHelpString(t),e)},HelpFormatter.prototype._splitLines=function(t,e){var r=[],n=[" ",".",",","!","?"],i=new RegExp("["+n.join("")+"][^"+n.join("")+"]*$");return t=t.replace(/[\n\|\t]/g," "),t=t.trim(),t=t.replace(this._whitespaceMatcher," "),t.split(c.EOL).forEach(function(t){if(e>=t.length)return void r.push(t);for(var o=0,a=e,s=0;a<=t.length;)a!==t.length&&n.indexOf(t[a]<-1)&&(s=(i.exec(t.substring(o,a))||{}).index,a=o+s+1),r.push(t.substring(o,a)),o=a,a+=e;o<t.length&&r.push(t.substring(o,a))}),r},HelpFormatter.prototype._fillText=function(t,e,r){var n=this._splitLines(t,e);return n=n.map(function(t){return r+t}),n.join(c.EOL)},HelpFormatter.prototype._getHelpString=function(t){return t.help};